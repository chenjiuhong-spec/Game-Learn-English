<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¹å­¦è‹±è¯­ - ä¸“ä¸ºé•¿è€…è®¾è®¡</title>
    <!-- å¼•å…¥ Tailwind CSS CDNï¼Œç”¨äºå¿«é€Ÿæ„å»ºå“åº”å¼å’Œç¾è§‚çš„ç•Œé¢ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è‡ªå®šä¹‰CSSï¼šè°ƒæ•´å­—ä½“å¤§å°ä»¥é€‚åº”æ‰‹æœºå•é¡µè§†å›¾ï¼Œä½†ä»éœ€ä¿æŒé«˜å¯è¯»æ€§ */
        body {
            font-family: 'Inter', 'Microsoft YaHei', 'SimHei', sans-serif;
            background-color: #e0f7fa; /* éå¸¸æµ…çš„æµ…è“è‰²åº• */
            display: flex;
            justify-content: center;
            align-items: flex-start;
            /* ç§»é™¤ min-height: 100vh ä»¥é˜²æ­¢åœ¨å†…å®¹å‹ç¼©åä»ç„¶å¼ºåˆ¶é¡µé¢é«˜åº¦ */
            padding: 0.5rem; /* å‡å°‘æ•´ä½“é¡µè¾¹è· */
            padding-top: 1rem;
        }

        /* è°ƒæ•´å­—ä½“å¤§å°ï¼Œä½¿ç”¨æ›´å°çš„å°ºå¯¸ä»¥é€‚åº”æ‰‹æœºå±å¹•ï¼Œä½†ä¿æŒæ¯”é»˜è®¤æ–‡æœ¬å¤§ */
        .text-xl-plus { font-size: 1.25rem; line-height: 1.75rem; } /* text-xl */
        .text-2xl-plus { font-size: 1.5rem; line-height: 2rem; } /* text-2xl */
        .text-3xl-plus { font-size: 1.875rem; line-height: 2.25rem; } /* text-3xl */
        .text-4xl-plus { font-size: 2.5rem; line-height: 3rem; } /* text-4xl */
        
        /* è°ƒæ•´å·¨å¤§çš„è¡¨æƒ…ç¬¦å·å¤§å°ï¼Œç¡®ä¿åœ¨æ¨¡æ€æ¡†ä¸­ä¸ä¼šæº¢å‡º */
        .text-emoji-giant { 
            font-size: 5rem; /* çº¦ 80px */
            line-height: 1;
            text-shadow: 0 0 10px rgba(255, 255, 0, 0.8); 
        }

        /* éšè—æ»šåŠ¨æ¡ä½†å…è®¸å†…å®¹æ»šåŠ¨ (åœ¨æ‰‹æœºä¸Šé€šå¸¸ä¸éœ€è¦) */
        body::-webkit-scrollbar { display: none; }
        body { -ms-overflow-style: none; scrollbar-width: none; }

        /* è‡ªå®šä¹‰æŒ‰é’®æ ·å¼ï¼Œå¢åŠ è§†è§‰å¸å¼•åŠ› */
        .action-button {
            transition: transform 0.1s;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2); /* ç•¥å¾®å‡å°é˜´å½± */
        }
        .action-button:active {
            transform: scale(0.95);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
        }
        
        /* æ¨¡æ€æ¡†èƒŒæ™¯ */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(2px);
            z-index: 50;
        }

        /* çº§åˆ«å‡çº§æ’’èŠ±æ•ˆæœ (Confetti) */
        .confetti {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 100;
        }
        .confetti-piece {
            position: absolute;
            width: 8px; /* å‡å°æ’’èŠ±ç‰‡å¤§å° */
            height: 16px; 
            background-color: #ffc107; /* Yellow */
            opacity: 0;
            transform-origin: 50% 50%;
            animation: fall 10s linear infinite;
        }
        @keyframes fall {
            0% { opacity: 1; transform: translate(var(--x, 0), -100px) rotate(0deg); }
            100% { opacity: 0; transform: translate(var(--x, 0), 100vh) rotate(720deg); }
        }

    </style>
</head>
<body class="bg-blue-50">
    <div id="app" class="w-full max-w-lg flex flex-col items-center">

        <!-- é¡¶éƒ¨ä¿¡æ¯æ : Level å’Œ Score (å‡å°‘ p-2 mt-2 mb-2) -->
        <div class="flex justify-between w-full p-2 mb-3 rounded-xl bg-white shadow-lg">
            
            <!-- Level Display (å‡å°‘ p-2) -->
            <div class="flex items-center space-x-2 bg-blue-100 p-2 rounded-xl shadow-inner">
                <span id="level-icon" class="text-2xl-plus">ğŸ </span>
                <div class="flex flex-col">
                    <span class="text-xl-plus font-bold text-gray-700">ç¬¬ <span id="current-level-num">1</span> çº§</span>
                    <span id="level-name" class="text-2xl-plus font-extrabold text-blue-700">å®¶å±…åŸºç¡€</span>
                </div>
            </div>

            <!-- Score/Fuel Display (å‡å°‘ p-2) -->
            <div class="flex items-center space-x-2 bg-red-100 p-2 rounded-xl shadow-inner">
                <span class="text-2xl-plus">ğŸ”¥</span>
                <div class="flex flex-col items-end">
                    <span class="text-xl-plus font-bold text-gray-700">ç§¯åˆ†</span>
                    <span id="score-display" class="text-2xl-plus font-extrabold text-red-700">0</span>
                </div>
            </div>
        </div>

        <!-- ä¸»è¦å­¦ä¹ å¡ç‰‡ (ç™½è‰²çš„é•¿æ–¹å½¢æ¡†) (å‡å°‘ p-4 mb-4) -->
        <div class="w-full bg-white p-4 rounded-3xl shadow-2xl flex flex-col items-center space-y-4 mb-4">
            <p class="text-xl-plus font-semibold text-gray-800 self-start">å¤§å£°è¯»å‡ºæ­£ç¡®çš„è‹±æ–‡ï¼š</p>

            <!-- è‹±æ–‡å’Œæ”¶å¬æŒ‰é’®çš„è“è‰²æ¡† (å‡å°‘ p-4) -->
            <div class="w-full bg-blue-600 p-4 rounded-2xl shadow-inner flex flex-col items-center space-y-3 text-center">
                <span id="english-text" class="text-4xl-plus font-black text-white leading-snug">Hello</span>
                
                <!-- æ–°å¢çŠ¶æ€æç¤ºæ ï¼Œä¸ä¼šè¦†ç›–è‹±æ–‡å¥å­ -->
                <p id="speech-status" class="text-xl-plus font-bold text-yellow-300 hidden">ç‚¹æˆ‘è¯´è¯</p>

                <!-- æ”¶å¬æ ‡å‡†å‘éŸ³æŒ‰é’® (å‡å°‘ padding å’Œå­—ä½“) -->
                <button onclick="handleTTS()" class="action-button flex items-center justify-center space-x-2 bg-blue-800 text-white py-2 px-4 rounded-full w-full max-w-xs transition duration-150 ease-in-out">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 3v14a1 1 0 01-1.707.707L6.683 15H4a1 1 0 01-1-1V6a1 1 0 011-1h2.683l2.21-2.21A1 1 0 019.383 3.076zM12 7a1 1 0 000 6.945A7.001 7.001 0 0015.42 10 7.001 7.001 0 0012 7z" clip-rule="evenodd" />
                    </svg>
                    <span class="text-xl-plus font-bold">æ”¶å¬æ ‡å‡†å‘éŸ³</span>
                </button>
            </div>

            <!-- ä¸­æ–‡ç¿»è¯‘ -->
            <p id="chinese-translation" class="text-3xl-plus font-bold text-gray-600 pt-1">ä½ å¥½</p>
        </div>
        
        <!-- ç‚¹æˆ‘è¯´è¯æŒ‰é’® (åœ†å½¢çº¢åº•) (ç¼©å°å°ºå¯¸: w-32 h-32; å‡å°‘ mb-4) -->
        <button id="speak-button" onclick="handleSpeechRecognition()" class="action-button flex flex-col items-center justify-center bg-red-600 text-white w-32 h-32 rounded-full transition duration-300 ease-in-out hover:bg-red-700 active:bg-red-800 shadow-2xl mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4z" clip-rule="evenodd" />
                <path fill-rule="evenodd" d="M12 6.5a1 1 0 01-2 0v2a1 1 0 012 0v-2zm-2-4a5 5 0 00-5 5v2.383a1 1 0 01-.894.894L4 12v3h12v-3l-1.106-1.106a1 1 0 01-.894-.894V7.5a5 5 0 00-5-5zM14 15.5a1 1 0 100-2 1 1 0 000 2zM6 15.5a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
            </svg>
            <span class="text-xl-plus font-bold mt-1">ç‚¹æˆ‘è¯´è¯</span>
        </button>

        <!-- è·³è¿‡è¿™ä¸€é¢˜æŒ‰é’® (ç°è‰²) (å‡å°‘ padding å’Œå­—ä½“) -->
        <button id="skip-button" onclick="skipQuestion()" class="action-button flex items-center space-x-1 text-gray-500 py-1 px-3 rounded-full transition duration-150 ease-in-out hover:bg-gray-200">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
            <span class="text-xl-plus font-semibold">è·³è¿‡è¿™ä¸€é¢˜ (ä¸ç»™ç§¯åˆ†)</span>
        </button>

        <!-- æ¨¡æ€æ¡†å®¹å™¨ -->
        <div id="modal-container"></div>
        
        <!-- æ’’èŠ±å®¹å™¨ -->
        <div id="confetti-container" class="confetti"></div>
    </div>

    <script>
        // =================================================================
        // æ¸¸æˆé…ç½®å’Œæ•°æ® (ç¡¬ç¼–ç  - æ»¡è¶³50ä¸ªå¥å­/å•è¯çš„è¦æ±‚)
        // =================================================================
        
        const SCORE_TO_LEVEL_UP = 20; // å‡çº§æ‰€éœ€ç§¯åˆ†
        const MAX_LEVEL = 5; // æ¸¸æˆæœ€å¤§ç­‰çº§

        const LEVEL_DATA = {
            1: { 
                name: "å®¶å±…åŸºç¡€", 
                icon: "ğŸ ", 
                score: 10,
                sentences: [
                    ["This is my home.", "è¿™æ˜¯æˆ‘çš„å®¶ã€‚"],
                    ["I am cleaning the kitchen.", "æˆ‘æ­£åœ¨æ‰“æ‰«å¨æˆ¿ã€‚"],
                    ["The light is on.", "ç¯äº®ç€ã€‚"],
                    ["Please close the window.", "è¯·å…³ä¸Šçª—æˆ·ã€‚"],
                    ["Where is the remote?", "é¥æ§å™¨åœ¨å“ªé‡Œï¼Ÿ"],
                    ["I need to buy a new sofa.", "æˆ‘éœ€è¦ä¹°ä¸€ä¸ªæ–°æ²™å‘ã€‚"],
                    ["Please wash your hands.", "è¯·æ´—æ‰‹ã€‚"],
                    ["Turn off the light when you leave.", "ç¦»å¼€æ—¶è¯·å…³ç¯ã€‚"],
                    ["Is it hot in here?", "è¿™é‡Œçƒ­å—ï¼Ÿ"],
                    ["I am home!", "æˆ‘å›æ¥äº†ï¼"],
                    ["The bed is soft.", "åºŠå¾ˆè½¯ã€‚"],
                    ["My glasses are on the table.", "æˆ‘çš„çœ¼é•œåœ¨æ¡Œå­ä¸Šã€‚"],
                    ["I'm going to sleep now.", "æˆ‘ç°åœ¨è¦å»ç¡è§‰äº†ã€‚"],
                    ["I need a cup of tea.", "æˆ‘éœ€è¦ä¸€æ¯èŒ¶ã€‚"],
                    ["Where is the bathroom?", "æ´—æ‰‹é—´åœ¨å“ªé‡Œï¼Ÿ"],
                    ["The key is in the lock.", "é’¥åŒ™åœ¨é”é‡Œã€‚"],
                    ["The floor is clean.", "åœ°æ¿å¾ˆå¹²å‡€ã€‚"],
                    ["Dinner is ready.", "æ™šé¥­å‡†å¤‡å¥½äº†ã€‚"],
                    ["I like this chair.", "æˆ‘å–œæ¬¢è¿™æŠŠæ¤…å­ã€‚"],
                    ["The door is open.", "é—¨å¼€ç€ã€‚"],
                    ["Let's watch TV.", "æˆ‘ä»¬çœ‹ç”µè§†å§ã€‚"],
                    ["My dog is sleeping.", "æˆ‘çš„ç‹—åœ¨ç¡è§‰ã€‚"],
                    ["I need a blanket.", "æˆ‘éœ€è¦ä¸€æ¡æ¯¯å­ã€‚"],
                    ["The clock is fast.", "è¿™ä¸ªé’Ÿå¿«äº†ã€‚"],
                    ["Where are my shoes?", "æˆ‘çš„é‹åœ¨å“ªé‡Œï¼Ÿ"],
                    ["I will call you later.", "æˆ‘ç¨åç»™ä½ æ‰“ç”µè¯ã€‚"],
                    ["It's time to eat breakfast.", "æ˜¯æ—¶å€™åƒæ—©é¥­äº†ã€‚"],
                    ["I can't find my phone.", "æˆ‘æ‰¾ä¸åˆ°æˆ‘çš„æ‰‹æœºã€‚"],
                    ["The water is boiling.", "æ°´å¼€äº†ã€‚"],
                    ["I need to hang up the clothes.", "æˆ‘éœ€è¦æ™¾è¡£æœã€‚"],
                    ["The mirror is dirty.", "é•œå­è„äº†ã€‚"],
                    ["I'm reading a book.", "æˆ‘æ­£åœ¨çœ‹ä¹¦ã€‚"],
                    ["Please open the curtain.", "è¯·æ‹‰å¼€çª—å¸˜ã€‚"],
                    ["The washing machine is running.", "æ´—è¡£æœºæ­£åœ¨è¿è¡Œã€‚"],
                    ["Do you like this color?", "ä½ å–œæ¬¢è¿™ä¸ªé¢œè‰²å—ï¼Ÿ"],
                    ["I feel cold.", "æˆ‘è§‰å¾—å†·ã€‚"],
                    ["This is a lovely picture.", "è¿™æ˜¯ä¸€å¼ å¯çˆ±çš„ç…§ç‰‡ã€‚"],
                    ["I am organizing my desk.", "æˆ‘æ­£åœ¨æ•´ç†æˆ‘çš„æ¡Œå­ã€‚"],
                    ["The heating is on.", "æš–æ°”å¼€ç€ã€‚"],
                    ["I bought some fresh fruit.", "æˆ‘ä¹°äº†ä¸€äº›æ–°é²œæ°´æœã€‚"],
                    ["Can you help me with this?", "ä½ èƒ½å¸®æˆ‘è¿™ä¸ªå—ï¼Ÿ"],
                    ["I don't feel well.", "æˆ‘æ„Ÿè§‰ä¸èˆ’æœã€‚"],
                    ["Please sit down here.", "è¯·ååœ¨è¿™é‡Œã€‚"],
                    ["The battery is low.", "ç”µæ± å¿«æ²¡ç”µäº†ã€‚"],
                    ["It's too loud.", "å£°éŸ³å¤ªå¤§äº†ã€‚"],
                    ["I have finished my work.", "æˆ‘å®Œæˆæˆ‘çš„å·¥ä½œäº†ã€‚"],
                    ["The drawer is stuck.", "æŠ½å±‰å¡ä½äº†ã€‚"],
                    ["I need to go outside.", "æˆ‘éœ€è¦å‡ºå»ä¸€ä¸‹ã€‚"],
                    ["The carpet is new.", "åœ°æ¯¯æ˜¯æ–°çš„ã€‚"],
                    ["I am going to the garden.", "æˆ‘è¦å»èŠ±å›­ã€‚"]
                ]
            },
            2: { 
                name: "ç¤¾åŒºäº¤æµ", 
                icon: "ğŸ˜ï¸", 
                score: 15,
                sentences: [
                    ["Good morning, neighbor.", "æ—©ä¸Šå¥½ï¼Œé‚»å±…ã€‚"],
                    ["Thank you for your help.", "è°¢è°¢ä½ çš„å¸®åŠ©ã€‚"],
                    ["Excuse me, where is the library?", "å¯¹ä¸èµ·ï¼Œè¯·é—®å›¾ä¹¦é¦†åœ¨å“ªé‡Œï¼Ÿ"],
                    ["Have a nice day!", "ç¥ä½ æœ‰ä¸ªç¾å¥½çš„ä¸€å¤©ï¼"],
                    ["What time is it now?", "ç°åœ¨å‡ ç‚¹äº†ï¼Ÿ"],
                    ["I need to see a doctor.", "æˆ‘éœ€è¦çœ‹åŒ»ç”Ÿã€‚"],
                    ["The bus stop is around the corner.", "å…¬äº¤è½¦ç«™å°±åœ¨æ‹è§’å¤„ã€‚"],
                    ["I am sorry for the mistake.", "æˆ‘å¯¹æˆ‘çš„é”™è¯¯æ„Ÿåˆ°æŠ±æ­‰ã€‚"],
                    ["May I ask a question?", "æˆ‘å¯ä»¥é—®ä¸€ä¸ªé—®é¢˜å—ï¼Ÿ"],
                    ["How do you spell that?", "é‚£ä¸ªæ€ä¹ˆæ‹¼å†™ï¼Ÿ"],
                    ["Can you speak slowly, please?", "è¯·æ‚¨è¯´æ…¢ä¸€ç‚¹å¥½å—ï¼Ÿ"],
                    ["I live nearby.", "æˆ‘å°±ä½åœ¨é™„è¿‘ã€‚"],
                    ["This park is very clean.", "è¿™ä¸ªå…¬å›­å¾ˆå¹²å‡€ã€‚"],
                    ["I am going to the pharmacy.", "æˆ‘è¦å»è¯åº—ã€‚"],
                    ["Goodbye, see you tomorrow.", "å†è§ï¼Œæ˜å¤©è§ã€‚"],
                    ["Do you have any suggestions?", "ä½ æœ‰ä»€ä¹ˆå»ºè®®å—ï¼Ÿ"],
                    ["I don't understand that.", "æˆ‘ä¸æ˜ç™½é‚£ä¸ªã€‚"],
                    ["I need help with this form.", "æˆ‘éœ€è¦å¸®åŠ©å¡«å†™è¿™å¼ è¡¨æ ¼ã€‚"],
                    ["Where is the nearest bank?", "æœ€è¿‘çš„é“¶è¡Œåœ¨å“ªé‡Œï¼Ÿ"],
                    ["It was nice talking to you.", "å¾ˆé«˜å…´å’Œä½ äº¤è°ˆã€‚"],
                    ["Can I pay with cash?", "æˆ‘å¯ä»¥ç”¨ç°é‡‘æ”¯ä»˜å—ï¼Ÿ"],
                    ["How are you doing today?", "ä½ ä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿ"],
                    ["I am feeling much better.", "æˆ‘æ„Ÿè§‰å¥½å¤šäº†ã€‚"],
                    ["The community center is open.", "ç¤¾åŒºä¸­å¿ƒå¼€æ”¾äº†ã€‚"],
                    ["Where can I find a map?", "æˆ‘åœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°åœ°å›¾ï¼Ÿ"],
                    ["I appreciate your patience.", "æˆ‘æ„Ÿè°¢æ‚¨çš„è€å¿ƒã€‚"],
                    ["Please wait for me here.", "è¯·åœ¨è¿™é‡Œç­‰æˆ‘ã€‚"],
                    ["What is your phone number?", "ä½ çš„ç”µè¯å·ç æ˜¯å¤šå°‘ï¼Ÿ"],
                    ["I am looking for a quiet place.", "æˆ‘æ­£åœ¨æ‰¾ä¸€ä¸ªå®‰é™çš„åœ°æ–¹ã€‚"],
                    ["I would like a receipt, please.", "è¯·ç»™æˆ‘ä¸€å¼ æ”¶æ®ã€‚"],
                    ["Is this seat taken?", "è¿™ä¸ªåº§ä½æœ‰äººåå—ï¼Ÿ"],
                    ["Let's meet at the entrance.", "æˆ‘ä»¬åœ¨å…¥å£å¤„è§é¢å§ã€‚"],
                    ["The store closes at five.", "è¿™å®¶å•†åº—äº”ç‚¹å…³é—¨ã€‚"],
                    ["Do you have this in a larger size?", "è¿™ä¸ªæœ‰å¤§ä¸€ç‚¹çš„å°ºç å—ï¼Ÿ"],
                    ["I will take this one.", "æˆ‘è¦è¿™ä¸ªã€‚"],
                    ["I need to register here.", "æˆ‘éœ€è¦åœ¨è¿™é‡Œæ³¨å†Œã€‚"],
                    ["Please fill out this paper.", "è¯·å¡«å†™è¿™å¼ çº¸ã€‚"],
                    ["What kind of weather is it?", "ä»Šå¤©æ˜¯ä»€ä¹ˆæ ·çš„å¤©æ°”ï¼Ÿ"],
                    ["It's very cold outside.", "å¤–é¢å¾ˆå†·ã€‚"],
                    ["I am retired now.", "æˆ‘ç°åœ¨é€€ä¼‘äº†ã€‚"],
                    ["I am enjoying my life.", "æˆ‘æ­£åœ¨äº«å—æˆ‘çš„ç”Ÿæ´»ã€‚"],
                    ["The concert was wonderful.", "éŸ³ä¹ä¼šå¾ˆç²¾å½©ã€‚"],
                    ["Do you have Wi-Fi here?", "è¿™é‡Œæœ‰æ— çº¿ç½‘ç»œå—ï¼Ÿ"],
                    ["I'm visiting my friend.", "æˆ‘æ­£åœ¨æ‹œè®¿æˆ‘çš„æœ‹å‹ã€‚"],
                    ["I need to mail this letter.", "æˆ‘éœ€è¦å¯„è¿™å°ä¿¡ã€‚"],
                    ["Can you repeat that, please?", "è¯·ä½ é‡å¤ä¸€éå¥½å—ï¼Ÿ"],
                    ["I agree with you.", "æˆ‘åŒæ„ä½ çš„çœ‹æ³•ã€‚"],
                    ["We should help each other.", "æˆ‘ä»¬åº”è¯¥äº’ç›¸å¸®åŠ©ã€‚"],
                    ["I'm looking for the restroom.", "æˆ‘æ­£åœ¨æ‰¾æ´—æ‰‹é—´ã€‚"],
                    ["Please be careful.", "è¯·å°å¿ƒã€‚"]
                ]
            },
            3: { 
                name: "æˆ·å¤–æ´»åŠ¨", 
                icon: "ğŸŒ³", 
                score: 20,
                sentences: [
                    ["It is a sunny day.", "ä»Šå¤©æ˜¯ä¸ªæ™´å¤©ã€‚"],
                    ["I love walking in the park.", "æˆ‘å–œæ¬¢åœ¨å…¬å›­æ•£æ­¥ã€‚"],
                    ["Look at the beautiful flowers.", "çœ‹é‚£äº›ç¾ä¸½çš„èŠ±ã€‚"],
                    ["The air is very fresh.", "ç©ºæ°”éå¸¸æ–°é²œã€‚"],
                    ["I see a bird flying.", "æˆ‘çœ‹åˆ°ä¸€åªé¸Ÿåœ¨é£ã€‚"],
                    ["Let's climb the mountain.", "æˆ‘ä»¬å»çˆ¬å±±å§ã€‚"],
                    ["I enjoy the beach view.", "æˆ‘å–œæ¬¢æµ·æ»©çš„æ™¯è‰²ã€‚"],
                    ["The market is open today.", "å¸‚åœºä»Šå¤©å¼€é—¨ã€‚"],
                    ["The concert starts soon.", "éŸ³ä¹ä¼šå¾ˆå¿«å°±è¦å¼€å§‹äº†ã€‚"],
                    ["It might rain later.", "ç­‰ä¼šå„¿å¯èƒ½ä¼šä¸‹é›¨ã€‚"],
                    ["I need sunscreen.", "æˆ‘éœ€è¦é˜²æ™’éœœã€‚"],
                    ["Where is the hiking trail?", "å¾’æ­¥å°å¾„åœ¨å“ªé‡Œï¼Ÿ"],
                    ["The grass is green.", "è‰åœ°æ˜¯ç»¿è‰²çš„ã€‚"],
                    ["I am taking a photo.", "æˆ‘æ­£åœ¨æ‹ç…§ã€‚"],
                    ["Do you want an ice cream?", "ä½ æƒ³è¦å†°æ·‡æ·‹å—ï¼Ÿ"],
                    ["The sky is blue and clear.", "å¤©ç©ºæ˜¯è“è‰²ä¸”æ™´æœ—çš„ã€‚"],
                    ["It's getting dark now.", "ç°åœ¨å¤©å¿«é»‘äº†ã€‚"],
                    ["We should go back home.", "æˆ‘ä»¬åº”è¯¥å›å®¶äº†ã€‚"],
                    ["I feel so relaxed here.", "æˆ‘åœ¨è¿™é‡Œæ„Ÿåˆ°éå¸¸æ”¾æ¾ã€‚"],
                    ["The leaves are falling.", "æ ‘å¶æ­£åœ¨è½ä¸‹ã€‚"],
                    ["I found a pretty rock.", "æˆ‘æ‰¾åˆ°ä¸€å—æ¼‚äº®çš„çŸ³å¤´ã€‚"],
                    ["Let's have a picnic.", "æˆ‘ä»¬å»é‡é¤å§ã€‚"],
                    ["The river is very long.", "è¿™æ¡æ²³å¾ˆé•¿ã€‚"],
                    ["I bought fresh vegetables.", "æˆ‘ä¹°äº†æ–°é²œçš„è”¬èœã€‚"],
                    ["This park has many trees.", "è¿™ä¸ªå…¬å›­æœ‰å¾ˆå¤šæ ‘ã€‚"],
                    ["I lost my way.", "æˆ‘è¿·è·¯äº†ã€‚"],
                    ["Can you show me the directions?", "ä½ èƒ½ç»™æˆ‘æŒ‡è·¯å—ï¼Ÿ"],
                    ["I am sitting on the bench.", "æˆ‘ååœ¨é•¿å‡³ä¸Šã€‚"],
                    ["The wind is strong.", "é£å¾ˆå¤§ã€‚"],
                    ["It is a perfect day for exercise.", "ä»Šå¤©æ˜¯é”»ç‚¼èº«ä½“çš„å®Œç¾æ—¥å­ã€‚"],
                    ["I need a drink of water.", "æˆ‘éœ€è¦å–æ°´ã€‚"],
                    ["The sunset is beautiful.", "æ—¥è½å¾ˆç¾ä¸½ã€‚"],
                    ["Be careful of the steps.", "å°å¿ƒå°é˜¶ã€‚"],
                    ["I forgot my hat.", "æˆ‘å¿˜äº†å¸¦æˆ‘çš„å¸½å­ã€‚"],
                    ["The museum is free entry.", "åšç‰©é¦†æ˜¯å…è´¹å…¥åœºã€‚"],
                    ["Let's buy a souvenir.", "æˆ‘ä»¬ä¹°ä¸ªçºªå¿µå“å§ã€‚"],
                    ["I love this kind of weather.", "æˆ‘å–œæ¬¢è¿™ç§å¤©æ°”ã€‚"],
                    ["The street performers are good.", "è¡—å¤´è‰ºäººå¾ˆæ£’ã€‚"],
                    ["I need to charge my phone.", "æˆ‘éœ€è¦ç»™æ‰‹æœºå……ç”µã€‚"],
                    ["The fountain is running.", "å–·æ³‰åœ¨å–·æ°´ã€‚"],
                    ["Where can I find a public restroom?", "æˆ‘åœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°å…¬å…±æ´—æ‰‹é—´ï¼Ÿ"],
                    ["I'm waiting for my friend.", "æˆ‘æ­£åœ¨ç­‰æˆ‘çš„æœ‹å‹ã€‚"],
                    ["The zoo has many animals.", "åŠ¨ç‰©å›­é‡Œæœ‰å¾ˆå¤šåŠ¨ç‰©ã€‚"],
                    ["I like listening to the birds.", "æˆ‘å–œæ¬¢å¬é¸Ÿå«ã€‚"],
                    ["Let's take a break.", "æˆ‘ä»¬ä¼‘æ¯ä¸€ä¸‹å§ã€‚"],
                    ["This path is easy to walk.", "è¿™æ¡è·¯å¾ˆå®¹æ˜“èµ°ã€‚"],
                    ["I feel better after the walk.", "æ•£æ­¥åæˆ‘æ„Ÿè§‰å¥½å¤šäº†ã€‚"],
                    ["The stars are shining brightly.", "æ˜Ÿæ˜Ÿé—ªè€€ç€å…‰èŠ’ã€‚"],
                    ["I will go fishing tomorrow.", "æˆ‘æ˜å¤©è¦å»é’“é±¼ã€‚"],
                    ["I miss the fresh air.", "æˆ‘æƒ³å¿µæ–°é²œçš„ç©ºæ°”ã€‚"]
                ]
            },
            4: { 
                name: "äº¤é€šå‡ºè¡Œ", 
                icon: "ğŸšŒ", 
                score: 25,
                sentences: [
                    ["Where is the train station?", "ç«è½¦ç«™åœ¨å“ªé‡Œï¼Ÿ"],
                    ["I need a bus ticket.", "æˆ‘éœ€è¦ä¸€å¼ å…¬å…±æ±½è½¦ç¥¨ã€‚"],
                    ["How much is the fare?", "è½¦è´¹æ˜¯å¤šå°‘ï¼Ÿ"],
                    ["Please drive safely.", "è¯·å®‰å…¨é©¾é©¶ã€‚"],
                    ["Turn left at the next light.", "åœ¨ä¸‹ä¸€ä¸ªçº¢ç»¿ç¯å¤„å·¦è½¬ã€‚"],
                    ["Stop here, please.", "è¯·åœåœ¨è¿™é‡Œã€‚"],
                    ["I am going to the airport.", "æˆ‘è¦å»æœºåœºã€‚"],
                    ["Which platform is the train on?", "ç«è½¦åœ¨å“ªä¸ªç«™å°ï¼Ÿ"],
                    ["I need a taxi immediately.", "æˆ‘éœ€è¦ä¸€è¾†å‡ºç§Ÿè½¦ã€‚"],
                    ["Is this seat available?", "è¿™ä¸ªåº§ä½æœ‰äººåå—ï¼Ÿ"],
                    ["I feel carsick.", "æˆ‘æ™•è½¦ã€‚"],
                    ["How long will the ride take?", "è¿™æ¬¡è¡Œç¨‹éœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ"],
                    ["I missed the last bus.", "æˆ‘é”™è¿‡äº†æœ€åä¸€ç­å…¬å…±æ±½è½¦ã€‚"],
                    ["Can you take me to this address?", "ä½ èƒ½å¸¦æˆ‘å»è¿™ä¸ªåœ°å€å—ï¼Ÿ"],
                    ["The traffic is very heavy.", "äº¤é€šéå¸¸æ‹¥å µã€‚"],
                    ["The red light means stop.", "çº¢ç¯è¡¨ç¤ºåœæ­¢ã€‚"],
                    ["I need to transfer here.", "æˆ‘éœ€è¦åœ¨è¿™é‡Œæ¢ä¹˜ã€‚"],
                    ["Where are we going now?", "æˆ‘ä»¬ç°åœ¨è¦å»å“ªé‡Œï¼Ÿ"],
                    ["Please use the seat belt.", "è¯·ç³»å¥½å®‰å…¨å¸¦ã€‚"],
                    ["I need a map of the subway.", "æˆ‘éœ€è¦ä¸€å¼ åœ°é“å›¾ã€‚"],
                    ["The car broke down.", "æ±½è½¦æŠ›é”šäº†ã€‚"],
                    ["Is there a parking space?", "æœ‰åœè½¦ä½å—ï¼Ÿ"],
                    ["I need to rent a car.", "æˆ‘éœ€è¦ç§Ÿä¸€è¾†è½¦ã€‚"],
                    ["The journey was long.", "æ—…é€”å¾ˆæ¼«é•¿ã€‚"],
                    ["Please follow the speed limit.", "è¯·éµå®ˆé™é€Ÿã€‚"],
                    ["This lane is for buses only.", "è¿™æ¡è½¦é“åªä¾›å…¬å…±æ±½è½¦ä½¿ç”¨ã€‚"],
                    ["I prefer walking.", "æˆ‘æ›´å–œæ¬¢æ­¥è¡Œã€‚"],
                    ["The ticket machine is broken.", "å”®ç¥¨æœºåäº†ã€‚"],
                    ["I need to validate my ticket.", "æˆ‘éœ€è¦æ£€ç¥¨ã€‚"],
                    ["The destination is far away.", "ç›®çš„åœ°å¾ˆè¿œã€‚"],
                    ["I need to check the timetable.", "æˆ‘éœ€è¦æŸ¥çœ‹æ—¶é—´è¡¨ã€‚"],
                    ["Which exit should I take?", "æˆ‘åº”è¯¥èµ°å“ªä¸ªå‡ºå£ï¼Ÿ"],
                    ["I lost my luggage.", "æˆ‘ä¸¢å¤±äº†æˆ‘çš„è¡Œæã€‚"],
                    ["Is this the right direction?", "è¿™æ˜¯æ­£ç¡®çš„æ–¹å‘å—ï¼Ÿ"],
                    ["I am waiting for a connection.", "æˆ‘æ­£åœ¨ç­‰å€™è½¬æœºã€‚"],
                    ["Be careful when crossing the road.", "è¿‡é©¬è·¯æ—¶è¦å°å¿ƒã€‚"],
                    ["The bridge is closed.", "è¿™åº§æ¡¥å…³é—­äº†ã€‚"],
                    ["I will take the next stop.", "æˆ‘å°†åœ¨ä¸‹ä¸€ç«™ä¸‹è½¦ã€‚"],
                    ["How do I get to the city center?", "æˆ‘å¦‚ä½•åˆ°è¾¾å¸‚ä¸­å¿ƒï¼Ÿ"],
                    ["The driver was very friendly.", "å¸æœºéå¸¸å‹å¥½ã€‚"],
                    ["I need a round-trip ticket.", "æˆ‘éœ€è¦ä¸€å¼ å¾€è¿”ç¥¨ã€‚"],
                    ["I bought my ticket online.", "æˆ‘åœ¨ç½‘ä¸Šä¹°äº†ç¥¨ã€‚"],
                    ["Is there a discount for seniors?", "è€å¹´äººæœ‰æŠ˜æ‰£å—ï¼Ÿ"],
                    ["The road is very slippery.", "è·¯é¢å¾ˆæ»‘ã€‚"],
                    ["I see the sign now.", "æˆ‘ç°åœ¨çœ‹åˆ°æ ‡å¿—äº†ã€‚"],
                    ["I must be on time.", "æˆ‘å¿…é¡»å‡†æ—¶ã€‚"],
                    ["The ship is leaving soon.", "èˆ¹å¾ˆå¿«å°±è¦ç¦»å¼€äº†ã€‚"],
                    ["I need assistance with my bags.", "æˆ‘çš„è¡Œæéœ€è¦å¸®åŠ©ã€‚"],
                    ["Please watch your step.", "è¯·æ³¨æ„è„šä¸‹ã€‚"],
                    ["I am going straight ahead.", "æˆ‘ç›´èµ°ã€‚"]
                ]
            },
            5: { 
                name: "ç´§æ€¥æ±‚åŠ©", 
                icon: "ğŸš¨", 
                score: 30,
                sentences: [
                    ["Help! Call the police!", "æ•‘å‘½ï¼å«è­¦å¯Ÿï¼"],
                    ["I need an ambulance now.", "æˆ‘ç°åœ¨éœ€è¦ä¸€è¾†æ•‘æŠ¤è½¦ã€‚"],
                    ["I am hurt and cannot move.", "æˆ‘å—ä¼¤äº†ï¼Œä¸èƒ½åŠ¨ã€‚"],
                    ["There is a fire in the building.", "å¤§æ¥¼é‡Œç€ç«äº†ã€‚"],
                    ["I am lost and cannot find my way.", "æˆ‘è¿·è·¯äº†ï¼Œæ‰¾ä¸åˆ°è·¯ã€‚"],
                    ["I need a doctor immediately.", "æˆ‘éœ€è¦ç«‹åˆ»çœ‹åŒ»ç”Ÿã€‚"],
                    ["What is the emergency number?", "ç´§æ€¥ç”µè¯å·ç æ˜¯å¤šå°‘ï¼Ÿ"],
                    ["I have fallen down.", "æˆ‘æ‘”å€’äº†ã€‚"],
                    ["Can you call my son/daughter?", "ä½ èƒ½ç»™æˆ‘å„¿å­/å¥³å„¿æ‰“ç”µè¯å—ï¼Ÿ"],
                    ["I feel very sick.", "æˆ‘æ„Ÿè§‰å¾ˆä¸èˆ’æœã€‚"],
                    ["Please stay with me.", "è¯·å’Œæˆ‘å¾…åœ¨ä¸€èµ·ã€‚"],
                    ["I need water and shelter.", "æˆ‘éœ€è¦æ°´å’Œä½æ‰€ã€‚"],
                    ["Where is the nearest hospital?", "æœ€è¿‘çš„åŒ»é™¢åœ¨å“ªé‡Œï¼Ÿ"],
                    ["I have chest pain.", "æˆ‘èƒ¸å£ç—›ã€‚"],
                    ["My head hurts badly.", "æˆ‘å¤´å¾ˆç–¼ã€‚"],
                    ["Someone stole my bag.", "æœ‰äººå·äº†æˆ‘çš„åŒ…ã€‚"],
                    ["Please hurry!", "è¯·å¿«ç‚¹ï¼"],
                    ["I cannot breathe well.", "æˆ‘å‘¼å¸ä¸é¡ºç•…ã€‚"],
                    ["Is anyone a nurse or doctor?", "æœ‰äººæ˜¯æŠ¤å£«æˆ–åŒ»ç”Ÿå—ï¼Ÿ"],
                    ["I need help crossing the street.", "æˆ‘è¿‡é©¬è·¯éœ€è¦å¸®åŠ©ã€‚"],
                    ["My car broke down on the road.", "æˆ‘çš„è½¦åœ¨è·¯ä¸ŠæŠ›é”šäº†ã€‚"],
                    ["I need to report an accident.", "æˆ‘éœ€è¦æŠ¥å‘Šä¸€èµ·äº‹æ•…ã€‚"],
                    ["Is there a safe place to wait?", "æœ‰æ²¡æœ‰ä¸€ä¸ªå®‰å…¨çš„åœ°æ–¹å¯ä»¥ç­‰å¾…ï¼Ÿ"],
                    ["I need my medication.", "æˆ‘éœ€è¦æˆ‘çš„è¯ã€‚"],
                    ["I feel dizzy.", "æˆ‘æ„Ÿåˆ°å¤´æ™•ã€‚"],
                    ["I need to sit down.", "æˆ‘éœ€è¦åä¸‹ã€‚"],
                    ["My vision is blurry.", "æˆ‘çš„è§†åŠ›æ¨¡ç³Šã€‚"],
                    ["I am having an allergic reaction.", "æˆ‘æ­£åœ¨è¿‡æ•ã€‚"],
                    ["Please don't leave me alone.", "è¯·ä¸è¦ç•™ä¸‹æˆ‘ä¸€ä¸ªäººã€‚"],
                    ["I need to contact the embassy.", "æˆ‘éœ€è¦è”ç³»å¤§ä½¿é¦†ã€‚"],
                    ["The door is stuck.", "é—¨å¡ä½äº†ã€‚"],
                    ["I can't reach my keys.", "æˆ‘å¤Ÿä¸åˆ°æˆ‘çš„é’¥åŒ™ã€‚"],
                    ["I need directions to a police station.", "æˆ‘éœ€è¦å»è­¦å¯Ÿå±€çš„è·¯çº¿ã€‚"],
                    ["Please secure the area.", "è¯·ä¿æŠ¤å¥½è¿™ä¸ªåŒºåŸŸã€‚"],
                    ["I have a severe fever.", "æˆ‘æœ‰ä¸¥é‡çš„ä½çƒ§ã€‚"],
                    ["I am bleeding badly.", "æˆ‘æµè¡€å¾ˆä¸¥é‡ã€‚"],
                    ["Did anyone see what happened?", "æœ‰äººçœ‹åˆ°å‘ç”Ÿäº†ä»€ä¹ˆå—ï¼Ÿ"],
                    ["I lost my wallet.", "æˆ‘ä¸¢äº†é’±åŒ…ã€‚"],
                    ["I need food and warmth.", "æˆ‘éœ€è¦é£Ÿç‰©å’Œæ¸©æš–ã€‚"],
                    ["My phone is dead.", "æˆ‘çš„æ‰‹æœºæ²¡ç”µäº†ã€‚"],
                    ["I need a blanket.", "æˆ‘éœ€è¦ä¸€æ¡æ¯¯å­ã€‚"],
                    ["The road is blocked.", "é“è·¯è¢«å µä½äº†ã€‚"],
                    ["Is the situation under control?", "æƒ…å†µå¾—åˆ°æ§åˆ¶äº†å—ï¼Ÿ"],
                    ["I need a ride to the clinic.", "æˆ‘éœ€è¦æ­è½¦å»è¯Šæ‰€ã€‚"],
                    ["I am feeling weak.", "æˆ‘æ„Ÿåˆ°è™šå¼±ã€‚"],
                    ["I have a burn injury.", "æˆ‘çƒ§ä¼¤äº†ã€‚"],
                    ["Please call for technical support.", "è¯·å‘¼å«æŠ€æœ¯æ”¯æŒã€‚"],
                    ["My leg is broken.", "æˆ‘çš„è…¿æ–­äº†ã€‚"],
                    ["Is everything alright?", "ä¸€åˆ‡éƒ½å¥½å—ï¼Ÿ"],
                    ["I need to check out.", "æˆ‘éœ€è¦é€€æˆ¿ã€‚"]
                ]
            }
        };

        // =================================================================
        // æ¸¸æˆçŠ¶æ€ç®¡ç†
        // =================================================================
        let game = {
            currentLevel: 1,
            score: 0,
            levelScore: 0,
            sentences: [], // å­˜å‚¨å½“å‰ Level çš„æ‰€æœ‰ [English, Chinese] å¥å­
            usedIndices: new Set(), // å­˜å‚¨å·²ç”¨å¥å­çš„ç´¢å¼•ï¼Œç”¨äºç¡®ä¿ä¸é‡å¤
            currentSentence: null,
            recognition: null, // SpeechRecognition å®ä¾‹
            isSpeaking: false, // é¿å…é‡å¤ç‚¹å‡»
            isGameActive: false,
        };

        // =================================================================
        // UI å…ƒç´ å¼•ç”¨
        // =================================================================
        const DOMElements = {
            levelName: document.getElementById('level-name'),
            levelNum: document.getElementById('current-level-num'),
            levelIcon: document.getElementById('level-icon'),
            scoreDisplay: document.getElementById('score-display'),
            englishText: document.getElementById('english-text'),
            chineseTranslation: document.getElementById('chinese-translation'),
            speechStatus: document.getElementById('speech-status'), // æ–°å¢
            speakButton: document.getElementById('speak-button'),
            skipButton: document.getElementById('skip-button'),
            modalContainer: document.getElementById('modal-container'),
            confettiContainer: document.getElementById('confetti-container')
        };

        /**
         * æ ¹æ®æ€»åˆ†æ•°è®¡ç®—å½“å‰åº”åœ¨çš„çº§åˆ«
         * çº§åˆ« = floor(æ€»åˆ†æ•° / æ¯çº§æ‰€éœ€åˆ†æ•°) + 1
         */
        function deriveCurrentLevel(score) {
            // ç¡®ä¿åˆ†æ•° >= 0
            score = Math.max(0, score); 
            // Math.max(1, ...) ç¡®ä¿çº§åˆ«è‡³å°‘ä¸º 1
            return Math.max(1, Math.floor(score / SCORE_TO_LEVEL_UP) + 1);
        }

        // =================================================================
        // æ¸¸æˆæ ¸å¿ƒé€»è¾‘
        // =================================================================

        /**
         * åˆå§‹åŒ–æ¸¸æˆæˆ–é‡å¯æ¸¸æˆ
         */
        function initGame(score = 0) {
            game.score = score; // å…è®¸ä»éé›¶åˆ†æ•°å¼€å§‹ï¼ˆå¦‚æœå°†æ¥æ¥å…¥å­˜å‚¨ï¼‰
            game.currentLevel = deriveCurrentLevel(game.score); // æ ¹æ®åˆ†æ•°è®¡ç®—èµ·å§‹çº§åˆ«
            game.isGameActive = true;
            DOMElements.scoreDisplay.textContent = game.score;
            
            // ç¡®ä¿èµ·å§‹çº§åˆ«ä¸è¶…è¿‡æœ€å¤§çº§åˆ«
            if (game.currentLevel > MAX_LEVEL) {
                 handleGameOver();
                 return;
            }
            
            loadLevel();
        }

        /**
         * åŠ è½½å½“å‰ç­‰çº§çš„é…ç½®å’Œç¬¬ä¸€ä¸ªå¥å­
         */
        function loadLevel() {
            if (game.currentLevel > MAX_LEVEL) {
                handleGameOver();
                return;
            }

            const levelData = LEVEL_DATA[game.currentLevel];
            game.sentences = [...levelData.sentences];
            game.usedIndices = new Set();
            
            game.levelScore = game.score % SCORE_TO_LEVEL_UP; // ç¡®ä¿ levelScore æ˜¯å½“å‰çº§åˆ«å†…çš„è¿›åº¦

            // æ›´æ–°UI
            DOMElements.levelName.textContent = levelData.name;
            DOMElements.levelNum.textContent = game.currentLevel;
            DOMElements.levelIcon.textContent = levelData.icon;
            
            // ç¡®ä¿Speakå’ŒSkipæŒ‰é’®å¯ç”¨
            DOMElements.speakButton.classList.remove('opacity-50', 'pointer-events-none');
            DOMElements.skipButton.classList.remove('opacity-50', 'pointer-events-none');
            
            loadNewSentence();
        }

        /**
         * éšæœºåŠ è½½ä¸€ä¸ªæœªä½¿ç”¨çš„å¥å­
         */
        function loadNewSentence() {
            if (game.usedIndices.size === game.sentences.length) {
                // å½“å‰Levelå¥å­å…¨éƒ¨å®Œæˆ
                checkLevelUp(true);
                return;
            }

            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * game.sentences.length);
            } while (game.usedIndices.has(randomIndex));

            game.usedIndices.add(randomIndex);
            game.currentSentence = game.sentences[randomIndex];

            DOMElements.englishText.textContent = game.currentSentence[0];
            DOMElements.chineseTranslation.textContent = game.currentSentence[1];
        }

        /**
         * å¤„ç†ç§¯åˆ†å¢åŠ å’Œæ£€æŸ¥å‡çº§
         * @param {number} points - è·å¾—çš„ç§¯åˆ†
         * @returns {boolean} - å¦‚æœå‘ç”Ÿå‡çº§æˆ–æ¸¸æˆç»“æŸï¼Œè¿”å› true
         */
        function gainScore(points) {
            game.score += points;
            game.levelScore = game.score % SCORE_TO_LEVEL_UP; 
            DOMElements.scoreDisplay.textContent = game.score;
            
            // è¿”å› checkLevelUp çš„ç»“æœï¼Œä»¥ä¾¿ handleSpeechRecognition çŸ¥é“æ˜¯å¦è¦æ˜¾ç¤ºåé¦ˆ
            return checkLevelUp();
        }

        /**
         * æ£€æŸ¥æ˜¯å¦è¾¾åˆ°å‡çº§æ¡ä»¶
         * @param {boolean} forceLevelUp - å¼ºåˆ¶å‡çº§ (å½“æ‰€æœ‰å¥å­å®Œæˆæ—¶)
         * @returns {boolean} - å¦‚æœå‘ç”Ÿå‡çº§æˆ–æ¸¸æˆç»“æŸï¼Œè¿”å› true
         */
        function checkLevelUp(forceLevelUp = false) {
            const requiredLevel = deriveCurrentLevel(game.score); // æ ¹æ®æ€»åˆ†è®¡ç®—åº”åœ¨çš„çº§åˆ«
            let didAction = false; // è·Ÿè¸ªæ˜¯å¦å‘ç”Ÿäº†å‡çº§æˆ–æ¸¸æˆç»“æŸ

            // 1. æ£€æŸ¥åˆ†æ•°æ˜¯å¦å¯¼è‡´å‡çº§/è·¨çº§
            if (requiredLevel > game.currentLevel) {
                const oldLevel = game.currentLevel;
                game.currentLevel = requiredLevel;
                
                // ç¡®ä¿ä¸è¶…è¿‡æœ€å¤§çº§åˆ«
                if (game.currentLevel > MAX_LEVEL) {
                    game.currentLevel = MAX_LEVEL; 
                }

                if (game.currentLevel > oldLevel) {
                    // ** å…³é”®ä¿®å¤ï¼šæ˜¾ç¤ºå‡çº§æ¨¡æ€æ¡†å¹¶å®‰æ’åç»­åŠ è½½ **
                    showModal('levelUp', {
                        level: game.currentLevel,
                        name: LEVEL_DATA[game.currentLevel].name
                    });
                    
                    // å»¶è¿ŸåŠ è½½æ–°Levelï¼Œç­‰å¾… PopUp å’Œæ’’èŠ±æ•ˆæœ (10ç§’)
                    setTimeout(() => {
                        loadLevel();
                    }, 10000); 
                    didAction = true;
                }
            }
            
            // 2. æ£€æŸ¥æ˜¯å¦å› å®Œæˆæ‰€æœ‰å¥å­è€Œå‡çº§
            if (forceLevelUp && !didAction && game.currentLevel < MAX_LEVEL) {
                game.currentLevel++;
                showModal('levelUp', {
                    level: game.currentLevel,
                    name: LEVEL_DATA[game.currentLevel].name
                });
                
                setTimeout(() => {
                    loadLevel();
                }, 10000);
                didAction = true;
            }
            
            // 3. å¦‚æœè¾¾åˆ°äº†æœ€å¤§çº§åˆ«ä¸”å‡çº§ï¼Œåˆ™å¤„ç† Game Over
            if (game.currentLevel >= MAX_LEVEL && (didAction || forceLevelUp)) {
                handleGameOver();
                didAction = true;
            }

            // 4. æ­£å¸¸æƒ…å†µï¼šä¸åœ¨æ­¤å¤„åŠ è½½æ–°å¥å­ï¼Œè€Œæ˜¯äº¤ç»™ feedback modal çš„æŒ‰é’®å¤„ç†ï¼Œ
            // é¿å…åœ¨ levelUp modal å‡ºç°æ—¶ç«‹å³åŠ è½½ä¸‹ä¸€ä¸ªå¥å­ã€‚
            
            return didAction; // è¿”å›æ˜¯å¦å‘ç”Ÿäº†å‡çº§æˆ–æ¸¸æˆç»“æŸ
        }


        /**
         * å¤„ç†æ¸¸æˆç»“æŸ
         */
        function handleGameOver() {
            game.isGameActive = false;
            showModal('gameOver', { finalScore: game.score });
            
            // ç¡®ä¿Speakå’ŒSkipæŒ‰é’®ä¸å¯ç”¨
            DOMElements.speakButton.classList.add('opacity-50', 'pointer-events-none');
            DOMElements.skipButton.classList.add('opacity-50', 'pointer-events-none');
        }

        // =================================================================
        // è¯­éŸ³åŠŸèƒ½ (TTS å’Œ Recognition)
        // =================================================================

        /**
         * æ”¶å¬æ ‡å‡†å‘éŸ³ (TTS)
         */
        function handleTTS() {
            if (game.isSpeaking) return;
            const text = game.currentSentence[0];
            
            if ('speechSynthesis' in window) {
                game.isSpeaking = true;
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US'; // è®¾ç½®ä¸ºè‹±æ–‡å‘éŸ³
                utterance.pitch = 1.0;
                utterance.rate = 0.8; // ç¨æ…¢ä¸€ç‚¹ï¼Œæ–¹ä¾¿è€å¹´äººå¬
                utterance.volume = 1.0;

                utterance.onend = () => { game.isSpeaking = false; };
                utterance.onerror = (e) => {
                    game.isSpeaking = false;
                    console.error('TTS Error:', e);
                    showModal('info', { title: "å‘éŸ³é”™è¯¯", message: "æŠ±æ­‰ï¼Œæ‚¨çš„è®¾å¤‡æ— æ³•æ’­æ”¾æ ‡å‡†å‘éŸ³ã€‚" });
                };

                speechSynthesis.speak(utterance);
            } else {
                showModal('info', { title: "åŠŸèƒ½å—é™", message: "æŠ±æ­‰ï¼Œæ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³æ’­æ”¾åŠŸèƒ½ã€‚" });
            }
        }

        /**
         * å¯åŠ¨è¯­éŸ³è¯†åˆ« (SpeechRecognition)
         */
        function handleSpeechRecognition() {
            const targetText = game.currentSentence[0];
            const currentScore = LEVEL_DATA[game.currentLevel].score;

            if (!('SpeechRecognition' in window || 'webkitSpeechRecognition' in window)) {
                showModal('info', { title: "åŠŸèƒ½å—é™", message: "æŠ±æ­‰ï¼Œæ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¾“å…¥åŠŸèƒ½ã€‚" });
                return;
            }

            if (game.recognition) {
                game.recognition.stop();
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            game.recognition = new SpeechRecognition();
            game.recognition.lang = 'en-US'; // è¯†åˆ«è‹±æ–‡
            game.recognition.interimResults = false;
            game.recognition.maxAlternatives = 1;

            DOMElements.speechStatus.textContent = "ğŸ”Š æ­£åœ¨å¬... è¯·å¤§å£°è¯»å‡ºè‹±æ–‡å¥å­";
            DOMElements.speechStatus.classList.remove('hidden');
            DOMElements.speakButton.classList.add('bg-yellow-500', 'animate-pulse');

            game.recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.trim();
                const cleanTranscript = transcript.toLowerCase().replace(/[.,!?'"]+/g, '');
                const cleanTarget = targetText.toLowerCase().replace(/[.,!?'"]+/g, '');
                
                if (cleanTranscript === cleanTarget) {
                    // å‘éŸ³å‡†ç¡®
                    // å…³é”®ä¿®å¤ï¼šæ£€æŸ¥æ˜¯å¦å‡çº§ã€‚å¦‚æœå‡çº§äº†ï¼Œè¯¥å‡½æ•°ä¼šè¿”å› trueï¼Œé˜»æ­¢åç»­åé¦ˆ
                    const didLevelUpOrEnd = gainScore(currentScore); 
                    
                    if (!didLevelUpOrEnd) {
                        // å¦‚æœæ²¡æœ‰å‡çº§ï¼Œæ˜¾ç¤ºæˆåŠŸåé¦ˆï¼Œå¹¶è®©ç”¨æˆ·æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®è¿›å…¥ä¸‹ä¸€é¢˜
                        showModal('feedback', { 
                            success: true, 
                            score: currentScore 
                        });
                    }
                    // å¦‚æœå‡çº§äº†ï¼ŒcheckLevelUp å·²ç»è´Ÿè´£æ˜¾ç¤º LevelUp æ¨¡æ€æ¡†å’Œå®‰æ’ loadLevel
                    
                } else {
                    // å‘éŸ³ä¸æ­£ç¡®
                    showModal('feedback', { 
                        success: false, 
                        recognizedText: transcript 
                    });
                }
            };

            game.recognition.onerror = (event) => {
                console.error('Recognition Error:', event.error);
                
                let errorMessage;
                if (event.error === 'no-speech') {
                    errorMessage = "æœªæ£€æµ‹åˆ°è¯­éŸ³ã€‚è¯·å¤§å£°ä¸€ç‚¹ï¼Œå¹¶ç¡®ä¿åœ¨å¬åˆ°â€œæ­£åœ¨å¬â€æç¤ºåç«‹å³å¼€å§‹è®²è¯ã€‚";
                } else if (event.error === 'not-allowed') {
                    errorMessage = "éº¦å…‹é£æƒé™è¢«æ‹’ç»ã€‚è¯·æ£€æŸ¥æ‚¨çš„è®¾å¤‡æˆ–æµè§ˆå™¨è®¾ç½®ï¼Œå…è®¸ä½¿ç”¨éº¦å…‹é£ã€‚";
                } else {
                    errorMessage = "è¯­éŸ³è¯†åˆ«å¤±è´¥ï¼Œè¯·æ£€æŸ¥éº¦å…‹é£æƒé™ï¼Œæˆ–æ‚¨çš„å‘éŸ³ä¸å¤Ÿæ¸…æ™°ã€‚é”™è¯¯ä»£ç : " + event.error;
                }
                
                showModal('info', { 
                    title: "è¯†åˆ«å¤±è´¥", 
                    message: errorMessage
                });
            };

            game.recognition.onend = () => {
                // æ— è®ºæˆåŠŸã€å¤±è´¥è¿˜æ˜¯é”™è¯¯ï¼Œéƒ½æ¸…ç†çŠ¶æ€æç¤ºå¹¶åœæ­¢æŒ‰é’®åŠ¨ç”»
                DOMElements.speakButton.classList.remove('bg-yellow-500', 'animate-pulse');
                DOMElements.speechStatus.classList.add('hidden');
                DOMElements.speechStatus.textContent = '';
            };

            try {
                game.recognition.start();
            } catch (e) {
                console.error("Recognition start failed:", e);
                showModal('info', { title: "å¯åŠ¨å¤±è´¥", message: "è¯·ç¡®ä¿æ‚¨çš„æµè§ˆå™¨å…è®¸ä½¿ç”¨éº¦å…‹é£ã€‚" });
                DOMElements.speakButton.classList.remove('bg-yellow-500', 'animate-pulse');
                DOMElements.speechStatus.classList.add('hidden'); 
                DOMElements.speechStatus.textContent = '';
            }
        }

        /**
         * è·³è¿‡å½“å‰é¢˜ç›® (ä¸ç»™ç§¯åˆ†)
         */
        function skipQuestion() {
            showModal('info', {
                title: "é¢˜ç›®å·²è·³è¿‡",
                message: "æ‚¨é€‰æ‹©äº†è·³è¿‡ã€‚è¯·ç»§ç»­å­¦ä¹ ä¸‹ä¸€ä¸ªå¥å­ï¼",
            });
            // æ¨¡æ€æ¡†å…³é—­åï¼Œç”¨æˆ·ç‚¹å‡»æŒ‰é’®ä¼šè‡ªåŠ¨åŠ è½½æ–°å¥å­
            // closeModal(); 
            // loadNewSentence(); // ç¡®ä¿è·³è¿‡æ˜¯ç«‹å³è¿›è¡Œçš„
        }

        // =================================================================
        // UI å’Œ æ¨¡æ€æ¡†/åŠ¨ç”»
        // =================================================================

        /**
         * æ˜¾ç¤ºæ¨¡æ€æ¡†
         * @param {string} type - æ¨¡æ€æ¡†ç±»å‹ (feedback, levelUp, gameOver, info)
         * @param {object} data - æ¨¡æ€æ¡†æ‰€éœ€æ•°æ®
         */
        function showModal(type, data = {}) {
            DOMElements.modalContainer.innerHTML = ''; // æ¸…é™¤æ—§æ¨¡æ€æ¡†
            let contentHTML = '';
            let title = '';
            let buttonsHTML = '';
            const isSuccess = data.success === true;
            let duration = 3000; // é»˜è®¤æŒç»­æ—¶é—´

            if (type === 'feedback') {
                if (isSuccess) {
                    title = "ğŸ‰ å‘éŸ³å®Œç¾ï¼";
                    contentHTML = `<p class="text-3xl-plus font-bold text-green-700 mt-4">å¥–åŠ± +${data.score} ç§¯åˆ†ï¼</p>`;
                    // æˆåŠŸåé¦ˆï¼šç‚¹å‡»åå…³é—­æ¨¡æ€æ¡†å¹¶åŠ è½½æ–°å¥å­
                    buttonsHTML = `<button onclick="closeModal(); loadNewSentence()" class="action-button bg-green-600 hover:bg-green-700 text-white p-3 rounded-full text-2xl-plus font-bold w-full">ç»§ç»­å­¦ä¹ </button>`;
                    duration = 0; // æˆåŠŸä¹Ÿéœ€è¦ç”¨æˆ·æ‰‹åŠ¨å…³é—­ï¼Œé˜²æ­¢é”™è¿‡ç§¯åˆ†ä¿¡æ¯
                } else {
                    title = "ğŸ¤” å‘éŸ³æœ‰ç‚¹ä¸å‡†ç¡®";
                    contentHTML = `
                        <p class="text-2xl-plus font-bold text-gray-700 mt-4 mb-3">è¯·å†ä»”ç»†å¬å¬åŸæ–‡å¹¶é‡è¯•ã€‚</p>
                        ${data.recognizedText ? `<p class="text-xl-plus text-red-500">ï¼ˆæ‚¨è¯´çš„æ˜¯: ${data.recognizedText}ï¼‰</p>` : ''}
                    `;
                    // å¤±è´¥åé¦ˆï¼šç‚¹å‡»åå…³é—­æ¨¡æ€æ¡† (ä¸åŠ è½½æ–°å¥å­ï¼Œè®©ç”¨æˆ·é‡è¯•å½“å‰é¢˜)
                    buttonsHTML = `
                        <button onclick="closeModal()" class="action-button bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full text-2xl-plus font-bold w-full mb-3">å†è¯•ä¸€æ¬¡</button>
                        <button onclick="closeModal(); loadNewSentence()" class="action-button bg-gray-500 hover:bg-gray-600 text-white p-3 rounded-full text-2xl-plus font-bold w-full">è·³è¿‡ (ä¸ç»™ç§¯åˆ†)</button>
                    `;
                    duration = 0; // å¤±è´¥æ¨¡æ€æ¡†éœ€è¦æ‰‹åŠ¨å…³é—­
                }
            } else if (type === 'levelUp') {
                title = "ğŸš€ æ­å–œå‡çº§ï¼";
                // **å…³é”®ä¿®å¤ï¼šç¡®ä¿è¡¨æƒ…ç¬¦å·å’Œæ’’èŠ±æ•ˆæœå¯åŠ¨**
                contentHTML = `
                    <span class="text-emoji-giant">ğŸ‘</span>
                    <p class="text-3xl-plus font-bold text-purple-700 mt-4">æ‚¨å·²è¾¾åˆ°ç¬¬ ${data.level} çº§: ${data.name}ï¼</p>
                    <p class="text-2xl-plus text-gray-700">éš¾åº¦å·²æå‡ï¼å‘ç¯çƒè¾¾äººè¿ˆè¿›ï¼</p>
                `;
                buttonsHTML = `<!-- è‡ªåŠ¨å…³é—­ï¼Œæ— æŒ‰é’® -->`;
                duration = 10000; // 10ç§’æŒç»­
                createConfetti(duration); // å¯åŠ¨æ’’èŠ±
            } else if (type === 'gameOver') {
                title = "ğŸŒŸ ç¯çƒè¾¾äººï¼æ¸¸æˆèƒœåˆ©ï¼";
                contentHTML = `
                    <span class="text-emoji-giant">ğŸ†</span>
                    <p class="text-3xl-plus font-bold text-green-700 mt-4">æ­å–œæ‚¨ï¼Œå®Œæˆäº†æ‰€æœ‰ç­‰çº§ï¼</p>
                    <p class="text-2xl-plus text-gray-700">æœ€ç»ˆæ€»ç§¯åˆ†ï¼š${data.finalScore}</p>
                `;
                buttonsHTML = `<button onclick="closeModal(); initGame(0);" class="action-button bg-green-600 hover:bg-green-700 text-white p-3 rounded-full text-2xl-plus font-bold w-full">ä»å¤´å†ç©</button>`;
                duration = 10000; // 10ç§’æŒç»­
                createConfetti(duration);
            } else if (type === 'info') {
                title = data.title || "æç¤º";
                contentHTML = `<p class="text-2xl-plus font-bold text-gray-700 mt-4">${data.message}</p>`;
                // æ™®é€šä¿¡æ¯æ¡†ï¼šç‚¹å‡»åå…³é—­
                buttonsHTML = `<button onclick="closeModal()" class="action-button bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full text-2xl-plus font-bold w-full">å¥½çš„</button>`;
                duration = 0;
            }

            const modalHTML = `
                <div class="modal-overlay fixed inset-0 flex items-center justify-center p-4">
                    <div class="bg-white rounded-3xl p-6 w-full max-w-sm shadow-2xl text-center animate-in zoom-in duration-500">
                        <h2 class="text-4xl-plus font-extrabold mb-3 text-blue-800">${title}</h2>
                        ${contentHTML}
                        <div class="mt-6">${buttonsHTML}</div>
                    </div>
                </div>
            `;
            DOMElements.modalContainer.innerHTML = modalHTML;
            
            // å¦‚æœè®¾ç½®äº†è‡ªåŠ¨å…³é—­æ—¶é—´ (ä»…ç”¨äº levelUp å’Œ gameOver)
            if (duration > 0 && type !== 'feedback') {
                setTimeout(closeModal, duration);
            }
        }

        /**
         * å…³é—­æ¨¡æ€æ¡†
         */
        function closeModal() {
            DOMElements.modalContainer.innerHTML = '';
            DOMElements.confettiContainer.innerHTML = '';
            
            // ç¡®ä¿åœ¨æ¨¡æ€æ¡†å…³é—­åï¼Œç»§ç»­è¯­éŸ³è¯†åˆ«çš„ç›‘å¬ä¼šè¢«æ¸…ç†
            if (game.recognition) {
                game.recognition.stop();
            }
        }

        /**
         * å¯åŠ¨æ’’èŠ±æ•ˆæœ
         * @param {number} duration - æŒç»­æ—¶é—´ (æ¯«ç§’)
         */
        function createConfetti(duration) {
            const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#00bcd4', '#009688', '#4caf50', '#ffeb3b', '#ff9800', '#ff5722'];
            const container = DOMElements.confettiContainer;
            container.innerHTML = '';

            for (let i = 0; i < 100; i++) {
                const piece = document.createElement('div');
                piece.className = 'confetti-piece';
                piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                piece.style.left = `${Math.random() * 100}vw`;
                piece.style.setProperty('--x', `${(Math.random() - 0.5) * 200}px`);
                piece.style.animationDelay = `${Math.random() * 10}s`;
                piece.style.animationDuration = `${5 + Math.random() * 5}s`;
                piece.style.width = `${5 + Math.random() * 10}px`;
                piece.style.height = `${10 + Math.random() * 15}px`;
                container.appendChild(piece);
            }

            setTimeout(() => {
                container.innerHTML = '';
            }, duration);
        }

        // =================================================================
        // å¯åŠ¨
        // =================================================================
        
        // é¡µé¢åŠ è½½å®Œæˆåå¯åŠ¨æ¸¸æˆ
        window.onload = function() {
            initGame();
        };

    </script>
</body>
</html>
